# 扩展

*扩展*为现有的类、结构体、枚举类型、或协议添加了新功能。这也包括了为无访问权限的源代码扩展类型的能力（即所谓的*逆向建模*）。扩展和 Objective-C 中的分类类似。（与 Objective-C 的分类不同的是，Swift 的扩展没有名字。）

Swift 中的扩展可以：

- 添加计算实例属性和计算类型属性；
- 定义实例方法和类型方法；
- 提供新初始化器；
- 定义下标；
- 定义和使用新内嵌类型；
- 使现有的类型遵循某协议

在 Swift 中，你甚至可以扩展一个协议，以提供其要求的实现或添加符合类型的附加功能。详见[协议扩展](https://www.cnswift.org/此处应有连接)。

> 注意
>
> 扩展可以向一个类型添加新的方法，但是不能重写已有的方法。



- 扩展的语法

  使用 `extension` 关键字来声明扩展：

  ```
  extension SomeType {
      // new functionality to add to SomeType goes here
  }
  ```

  扩展可以使已有的类型遵循一个或多个协议。在这种情况下，协议名的书写方式与类或结构体完全一样：

  ```
  extension SomeType: SomeProtocol, AnotherProtocol {
      // implementation of protocol requirements goes here
  }
  ```

- 计算属性

  扩展可以向已有的类型添加计算实例属性和计算类型属性。下面的例子向 Swift 内建的 `Double` 类型添加了五个计算实例属性，以提供对距离单位的基本支持：

  ```
  extension Double {
      var km: Double {
          return self * 1000.0
      }
      
      var m: Double {
          return self
      }
      
      var cm: Double {
          return self / 100.0
      }
      
      var mm: Double {
          return self / 1000.0
      }
      
      var feet: Double {
          return self / 3.28084
      }
  }
  
  let oneInch = 25.4.mm
  print("onInch is \(oneInch) meters")
  let threeFeet = 3.feet
  print("3 feet is \(threeFeet) meters")
  ```

  > 注意
  >
  > 扩展可以添加新的计算属性，但是不能添加存储属性，也不能向已有的属性添加属性观察者。

- 初始化器

  扩展可向已有的类型添加新的初始化器。这允许你扩展其他类型以使初始化器接收你的自定义类型作为形式参数，或提供该类型的原始实现中未包含的额外初始化选项。

  扩展能为类添加新的便捷初始化器，但是不能为类添加指定初始化器或反初始化器。指定初始化器和反初始化器 必须由原来类的实现提供。

- 方法

  扩展可以为已有的类型添加新的实例方法和类型方法。

  ```
  extension Int {
      func repetitions(task: () -> Void) {
          for _ in 0..<self {
              task()
          }
      }
  }
  
  3.repetitions {
      print("Hello!")
  }
  // Hello!
  // Hello!
  // Hello!
  ```

- 异变实例方法

  增加了扩展的实例方法仍可以修改（或*异变*）实例本身。结构体和枚举类型方法在修改 self 或本身的属性时必须标记实例方法为 mutating ，和原本实现的异变方法一样。

  下面的例子为 Swift 的 Int 类型添加了一个新的异变方法 square ，以表示原值的平方：

  ```swift
  extension Int {
      mutating func square() {
          self = self * self
      }
  }
  var someInt = 3
  someInt.square()
  // someInt is now 9
  ```

- 下标

  扩展能为已有的类型添加新的下标。下面的例子为 Swift 内建的 Int 类型添加了一个整型下标。这个下标 [n] 返回了从右开始第 n 位的十进制数字：

  - 123456789[0] 返回 9
  - 123456789[1] 返回 8

  ……以此类推：

  ```swift
  extension Int {
      subscript(digitIndex: Int) -> Int {
          var decimalBase = 1
          for _ in 0..<digitIndex {
              decimalBase *= 10
          }
          return (self / decimalBase) % 10
      }
  }
  
  12345[4]//1
  54321[4]//5
  ```

- 内嵌类型

  扩展可以为已有的类、结构体和枚举类型添加新的内嵌类型：

  ```
  extension Int {
      enum Kind {
          case negative, zero, positive
      }
      var kind: Kind {
          switch self {
          case 0:
              return .zero
          case let x where x > 0:
              return .positive
          default:
              return .negative
          }
      }
  }
  ```

  这个内嵌的枚举类型可以和任意 Int 一起使用：

  ```
  func printIntegerKinds(_ numbers: [Int]) {
      for number in numbers {
          switch number.kind {
          case .negative:
              print("- ", terminator: "")
          case .zero:
              print("0 ", terminator: "")
          case .positive:
              print("+ ", terminator: "")
          }
      }
      print("")
  }
  printIntegerKinds([3, 19, -27, 0, -6, 0, 7])
  // Prints "+ + - 0 - 0 + "
  ```

  

> 注意
>
> 已知 number.kind 是 Int.Kind 类型。因此， switch 语句中的所有 Int.Kind 情况值都可以简写，例如用 .Negative 而不是Int.Kind.Negative 

