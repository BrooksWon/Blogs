# 学习-推荐系统中的召回与排序

> 近期业务系统中有使用到，特此学习下



![img](https://github.com/BrooksWon/Blogs/blob/master/think/product/%E5%AD%A6%E4%B9%A0-%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E4%B8%AD%E7%9A%84%E5%8F%AC%E5%9B%9E%E4%B8%8E%E6%8E%92%E5%BA%8F.png)



**推荐系统目标**

case1：资讯场景

比如资讯场景feed流业务目标是**点击率**。点击率 = click / show （推荐结果即show）

坑点：

- 加载即show（物料实际并未曝光）。导致show虚高
  - 解法：建议仅计算被曝光的show
- 重复曝光。导致show虚高
  - 解法：曝光去重

case2：小视频场景

比如小视频场景，建模目标是**完播率**。完播率率 = 视频播放的时长 / 视频总时长



**Netflix的推荐系统架构**

![](/Users/Brooks/blog/Blogs/think/product/netflix推荐系统架构.jpeg)

这是Netflix的推荐系统架构，分为离线、近线和在线层。这样的设计模式，在当前依然是主流模式。

1. 离线：不用实时数据，不提供实时服务；
2. 近线：使用实时数据，不保证实时服务；
3. 在线：使用实时数据，要保证实时服务。



**工业界大家都是怎么做召回的？**

微信看一看

![微信看一看](https://github.com/BrooksWon/Blogs/blob/master/think/product/%E5%BE%AE%E4%BF%A1%E7%9C%8B%E4%B8%80%E7%9C%8B.jpeg)



爱奇艺短视频

![爱奇艺短视频](https://github.com/BrooksWon/Blogs/blob/master/think/product/%E7%88%B1%E5%A5%87%E8%89%BA%E7%9F%AD%E8%A7%86%E9%A2%91.jpeg)



蜻蜓FM

![蜻蜓FM](https://github.com/BrooksWon/Blogs/blob/master/think/product/%E8%9C%BB%E8%9C%93FM.jpeg)



总结一下：**多路召回是当前推荐系统的主流架构**。

为什么大家都要用多路召回这种架构呢？

这样的设计主要有如下考虑：

1. 考虑用户层面：用户兴趣的多元化，用户需求与场景的多元化。例如：新闻需求，重大要闻，相关内容沉浸阅读等等
2. 考虑系统层面：增强系统的鲁棒性；部分召回失效，其余召回队列兜底不会导致整个召回层失效；排序层失效，召回队列兜底不会导致整个推荐系统失效。
3. 系统多样性内容分发：图文、视频、小视频；精准、试探、时效一定比例；召回目标的多元化，例如：相关性，沉浸时长，时效性，特色内容等等
4. 可解释性推荐一部分召回是有明确推荐理由的：很好的解决产品性数据的引入。



## 召回策略与场景

本模块主要回答如下几个问题：

1. 策略与场景的关系？
2. 如何设置场景的策略？



### 策略与场景的关系

先说结论：策略是强场景相关的～！

如何validate上述结论？

用户逛首页：这个时候，用户暂时没有明确的购物意图，就是想来看看，有什么什么物品能够吸引自己的兴趣。所以这个时候的召回策略，偏兴趣试探。

用户逛详情页：比如你这个时候就想买一只奶茶色的口红，你在某只口红的详情页研究了3分钟，并且下单了，这个时候给你推荐的，肯定还是奶茶色的口红。毕竟对女人来说，一只口红是买，两只口红也是买。



### 如何设置场景的策略？

是否有一些可以遵循的标准步骤/思考模式可以复用？

**第一步：看数据**

原则：任何策略都需要数据的支持。

use-case：

场景：运营同学、算法同学、还有你，大家在一起讨论是否要增加一路召回，这路召回的具体逻辑是按照用户兴趣topic进行召回。

思考逻辑：按照兴趣topic召回具体实现逻辑梳理：即用户画像有兴趣topic字段，比如我西蓝花，我的用户画像兴趣topic字段有健身，那么可以用这一路进行召回。

数据现状梳理：经过review用户画像数据，发现99%的用户，都没有兴趣topic字段。那这样的话，就算上了这一路召回，也没有多大价值。

如果思考到这里就结束了，那我觉得还是不够，我们还需要思考，如何获得用户的兴趣topic字段。这就需要从产品设计上进行考虑～比如小红书的引导

<img src="https://github.com/BrooksWon/Blogs/blob/master/think/product/%E5%B0%8F%E7%BA%A2%E4%B9%A6%E7%9A%84%E5%BC%95%E5%AF%BC.jpeg" alt="小红书的引导页" style="zoom:50%;" />

**第二步：看场景**

**原则：**

1. 推荐策略最本质的功能是参与构建使得用户沉浸其中的场景
2. 用户带着不同的动机进入不同的场景，在用户的浏览链路中，各个场景应该满足或者引导用户的需求。具体到召回与场景，不同的场景需要不同的召回通道，或者不同的场景对同一个召回通道有所偏重。举例，app推荐首页，更侧重用户兴趣试探，展示内容比较发散，使得用户能够找到自己感兴趣的主题。用户点击推荐页进入详情页，用户的兴趣进一步明确，在该页推荐的内容应该比较收敛。因此，结合业务需求，推荐页可能需要各种不同类型的召回通道，从召回上保证多样性。详情页可能不需要那么多召回通道，同时召回上保证相关性。

**use-case：**

场景：美团买菜，商品详情页，用户点击“加入购物车”，底部会弹出“买了又买”模块。

策略：在该场景，买了又买模块是当前场景，给用户推荐其加购商品同一类的商品。比如用户加购冰淇淋，则推荐冰淇淋；用户买零食，则推荐零食；用户买水果，则推荐水果。

一点延伸思考，美团买菜的这个产品设计，目标是什么？

有个朋友提问：”想请教下对于用户冷启动，这些方法怎么能比较靠靠谱滴落地呢？user、item的embedding没有行为数据情况还有什么方法可以得到吗？”

回答分为两层：

1. 第一，建议你梳理并讲解一下你们的业务背景；
2. 第二，你们做这个冷启动，业务目标是什么？是提升转化率还是点击率？

产品设计与目标永远都是结伴而行，不可分割。

如果看到一个推荐场景，我们不能条件反射地去思考，这个场景的目标是什么？背后站着的产品设计者（creator）是如何构建他所期望让用户沉浸其中的场景？也就是KNOW WHY 和KNOW HOW。那我们就应该强制自己这样思考。

回到美团买菜这个case本身。

- KNOW-WHY。该场景目标是什么？让用户购买更多的商品，提升的是GMV。
- KNOW-HOW。creator如何构建这个该场景？用户在详情页，加购某一商品，这个时候用户的兴趣意图是非常明确的。比如用户买钟薛高的冰淇淋，那么用户的意图可以分为：第一，用户希望买冰淇淋；第二，用户希望买钟薛高的冰淇淋。那么这个时候可以给用户推荐符合这两种条件的冰淇淋。

一点题外话：总会看到有人讨论推荐产品经理的价值，在推荐这整个系统中，主导的是算法，**那策略产品的价值是什么。我的理解是，策略产品很大一部分价值就是在挖掘场景，构建场景**。像用户加购商品后的买了又买模块，就是一个非常好的场景。

<img src="https://github.com/BrooksWon/Blogs/blob/master/think/product/%E7%BE%8E%E5%9B%A2%E4%B9%B0%E8%8F%9C-%E4%B9%B0%E4%BA%86%E5%8F%88%E4%B9%B0.jpeg" alt="美团买菜-买了又买" style="zoom:50%;" />

美团买菜这个场景的构建是蛮好的～既然有好的case，就必须说一个我觉得很差的case，没有对比哪能知道孰好孰坏。

<img src="https://github.com/BrooksWon/Blogs/blob/master/think/product/7fresh%E7%9A%84%E5%8A%A0%E8%B4%AD%E9%A1%B5%E9%9D%A2.jpeg" alt="美团买菜-买了又买" style="zoom:50%;" />





[源文件](https://github.com/BrooksWon/Blogs/blob/master/think/product/%E5%AD%A6%E4%B9%A0-%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E4%B8%AD%E7%9A%84%E5%8F%AC%E5%9B%9E%E4%B8%8E%E6%8E%92%E5%BA%8F.xmind)

