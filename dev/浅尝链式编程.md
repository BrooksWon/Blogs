# æµ…å°é“¾å¼ç¼–ç¨‹

[Masonry](https://github.com/SnapKit/Masonry) çš„å‡ºç°ï¼Œè®©æˆ‘æ„Ÿå—åˆ°äº†é“¾å¼ç¼–ç¨‹æ€æƒ³åœ¨Objective-Cç¼–ç ä¸­ä½“ç°å‡ºæ¥çš„ï¼šç®€å•æ˜“è¯»ã€ä¼˜é›…ã€‚

Masonryçš„ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š

```objective-c
[view1 mas_makeConstraints:^(MASConstraintMaker *make) {
    make.top.equalTo(superview.mas_top).with.offset(padding.top);
    make.left.equalTo(superview.mas_left).with.offset(padding.left);
    make.bottom.equalTo(superview.mas_bottom).with.offset(-padding.bottom);
    make.right.equalTo(superview.mas_right).with.offset(-padding.right);
}];
```

é“¾å¼ç¼–ç¨‹3è¦ç´ ï¼š`ç‚¹è¯­æ³•`ã€`å°æ‹¬å·è°ƒç”¨`ã€`è¿ç»­è®¿é—®`ï¼Œé‚£ä¹ˆ Objective-C ä¸­å¦‚ä½•å®ç°é“¾å¼ç¼–ç¨‹å‘¢ï¼Ÿå¯ä»¥é€šè¿‡å¦‚ä¸‹å‡ ç‚¹åšåˆ°ï¼š

- ç‚¹è¯­æ³•ï¼šå¯¹è±¡çš„å±æ€§è®¿é—®å¯ä»¥é€šè¿‡ç‚¹è¯­æ³•ï¼ˆå¦‚ï¼šself.xx æˆ–è€…someClassInstance.xxï¼‰ï¼›
  - è¿˜æœ‰å°±æ˜¯åœ¨OCä¸­`ç‚¹è¯­æ³•`çš„è°ƒç”¨ä¼šåœ¨ç¼–è¯‘æœŸè¢«æ›¿æ¢æˆä¸­æ‹¬å· `[]` è°ƒç”¨å½¢å¼ï¼Œå› æ­¤åªè¦åœ¨classä¸­å£°æ˜ä¸€ä¸ªåä¸º  `methodA` çš„æ–¹æ³•ï¼Œå³å¯åœ¨è°ƒç”¨å¤„ä»¥ `ç‚¹è¯­æ³•` çš„å½¢å¼è°ƒç”¨: `someClassInstance.methodA`ã€‚ä½†æ˜¯è¿™ç§æ–¹å¼ä¸é€‚ç”¨äºå¸¦å½¢å‚çš„æ–¹æ³•ã€‚
- å°æ‹¬å·è°ƒç”¨ï¼šOCä¸­ä¸€èˆ¬æ–¹æ³•çš„è°ƒç”¨æ–¹å¼æ˜¯ä¸­æ‹¬å·`[]`, è€Œ block åˆ™æ˜¯é€šè¿‡å°æ‹¬å· `()` çš„æ–¹å¼è°ƒç”¨çš„( å¦‚ï¼š`self.methodA()` æˆ–è€… `someClassInstance.methodA()` ) ï¼›å› æ­¤å¯ä»¥ç”¨ block æ¥å®ç°é“¾å¼ç¼–ç¨‹è¯­æ³•ä¸­çš„ `()`ï¼›
- è¿ç»­è®¿é—®ï¼šå¯ä»¥é€šè¿‡è®©è¢«è°ƒç”¨çš„ block è¿”å›å½“å‰è°ƒç”¨è€…æœ¬èº«ï¼Œå¦‚ï¼š `someClassInstance.methodA()` è¿”å›çš„æ˜¯å½“å‰ `someClassInstance` å®ä¾‹ï¼Œå› æ­¤å¯ä»¥ç»§ç»­åé¢çš„è¿ç»­è°ƒç”¨ `.methodB().methodC().xx `ï¼›æœ€ç»ˆå®ç°å¦‚ï¼š`someClassInstance.methodA().methodB().methodC().xx` è¿ç»­è°ƒç”¨æ–¹å¼ã€‚

ç†è®ºä¹‹åï¼Œå½“ç„¶æ˜¯ä¸Šä»£ç æ“ç»ƒä¸€ç•ªäº†ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªé“¾å¼ç¼–ç¨‹è®¡ç®—å™¨çš„ä¾‹å­ï¼Œå¯ä»¥è¿ç»­åœ°è°ƒç”¨è®¡ç®—å™¨çš„åŠ ã€å‡ã€ä¹˜ã€é™¤æ–¹æ³•è¿›è¡Œè®¡ç®—ã€‚

```objective-c
//Calculator.h

@interface Calculator : NSObject

@property (nonatomic, assign) NSInteger result; // ä¿å­˜è®¡ç®—ç»“æœ

//é“¾å¼
- (Calculator * (^)(NSInteger))add;
- (Calculator * (^)(NSInteger))subtract;
- (Calculator * (^)(NSInteger))multiply;
- (Calculator * (^)(NSInteger))divide;

@end
  
//***********************
//Calculator.m 

@implementation Calculator

- (Calculator * (^)(NSInteger))add {
    return ^Calculator *(NSInteger num){
        self.result += num;
        return self;
    };
}

- (Calculator *(^)(NSInteger))subtract {
    return ^Calculator *(NSInteger num) {
        self.result -= num;
        return self;
    };
}

- (Calculator *(^)(NSInteger))multiply {
    return ^Calculator *(NSInteger num) {
        self.result *= num;
        return self;
    };
}

- (Calculator *(^)(NSInteger))divide {
    return ^Calculator *(NSInteger num) {
        NSAssert(num != 0, @"é™¤æ•°ä¸èƒ½ä¸ºé›¶ï¼");
        self.result /= num;
        return self;
    };
}

@end
```

æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š

```objective-c
Calculator *c = [[Calculator alloc] init];// åˆå§‹åŒ–ä¸€ä¸ªè®¡ç®—å™¨ç±»å®ä¾‹
    
c.add(8).subtract(4).multiply(6).divide(3);// é“¾å¼è°ƒç”¨
NSLog(@"%ld", c.result);
```

åˆ†ææµ‹è¯•ä»£ç ï¼š`c.add(8).subtract(4).multiply(6).divide(3);`

```objective-c
ä¸Šé¢é€šè¿‡ c.add è®¿é—® c çš„ add å±æ€§ä¼šè°ƒç”¨ [c add] æ–¹æ³•ï¼Œæ­¤æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ª Block å¦‚ä¸‹ï¼š

    ^Calculator(NSInteger num) {
        self.result += num;
        return self;
    };

åœ¨è¿™ä¸ª Block ä¸­ï¼Œå‰é¢å·²å£°æ˜å…¶è¿”å›å€¼ç±»å‹ä¸ºï¼šCalculatorï¼Œæ‰€ä»¥åœ¨å…¶é‡Œé¢è¿”å›äº† selfï¼Œ
è¿™æ ·å½“è°ƒç”¨è¯¥ Block æ—¶ï¼Œä¼šè¿”å› selfï¼ˆå³ç±»å®ä¾‹æœ¬èº«ï¼‰ï¼Œæµç¨‹å¦‚ä¸‹ï¼š

(1) c.add -> è·å¾—ä¸€ä¸ª Blockï¼›
(2) c.add(8) -> Block çš„æ‰§è¡Œï¼Œå¹¶è¿”å›äº† selfï¼ˆå³å®ä¾‹ cï¼‰
(3) äºæ˜¯åœ¨ c.add(8) åé¢å¯ç»§ç»­è®¿é—® c çš„å…¶ä»–å±æ€§ï¼Œå®ç°ä¸€è·¯ç‚¹ä¸‹å»...
```

ä»¥ä¸Šï¼Œå³  `åœ¨ Objective-C ä¸­å¦‚ä½•å®ç°é“¾å¼ç¼–ç¨‹`ã€‚

ä¸‹é¢ğŸ‘‡ã€æ¥æ„Ÿå—ä¸‹**è®¡ç®—å™¨çš„ä¾‹å­**åœ¨ `ä¸ä½¿ç”¨é“¾å¼ç¼–ç¨‹` å’Œ `é“¾å¼ç¼–ç¨‹` çš„ä»£ç å¯¹æ¯”ã€‚

```objective-c
// .h

@interface Calculator : NSObject
@property (nonatomic, assign) NSInteger result; // ä¿å­˜è®¡ç®—ç»“æœ

//é“¾å¼
- (Calculator * (^)(NSInteger))add;
- (Calculator * (^)(NSInteger))subtract;
- (Calculator * (^)(NSInteger))multiply;
- (Calculator * (^)(NSInteger))divide;

//ä¸­æ‹¬å·ï¼ˆä¸ä½¿ç”¨é“¾å¼ç¼–ç¨‹ï¼‰
- (void)add:(NSInteger)num;
- (void)subtract:(NSInteger)num;
- (void)multiply:(NSInteger)num;
- (void)divide:(NSInteger)num;
@end

//*****************
//.m

@implementation Calculator

//é“¾å¼
- (Calculator * (^)(NSInteger))add {
    return ^Calculator *(NSInteger num){
        self.result += num;
        return self;
    };
}

- (Calculator *(^)(NSInteger))subtract {
    return ^Calculator *(NSInteger num) {
        self.result -= num;
        return self;
    };
}

- (Calculator *(^)(NSInteger))multiply {
    return ^Calculator *(NSInteger num) {
        self.result *= num;
        return self;
    };
}

- (Calculator *(^)(NSInteger))divide {
    return ^Calculator *(NSInteger num) {
        NSAssert(num != 0, @"é™¤æ•°ä¸èƒ½ä¸ºé›¶ï¼");
        self.result /= num;
        return self;
    };
}

//ä¸­æ‹¬å·ï¼ˆä¸ä½¿ç”¨é“¾å¼ç¼–ç¨‹ï¼‰
- (void)add:(NSInteger)num {
    self.result += num;
}

- (void)subtract:(NSInteger)num {
    self.result -= num;
}

- (void)multiply:(NSInteger)num {
    self.result *= num;
}

- (void)divide:(NSInteger)num {
    NSAssert(num != 0, @"é™¤æ•°ä¸èƒ½ä¸ºé›¶ï¼");
    self.result /= num;
}

@end
```

æµ‹è¯•ä»£ç å¯¹æ¯”

```objective-c
Calculator *c = [[Calculator alloc] init];

//é“¾å¼è°ƒç”¨
c.add(8).subtract(4).multiply(6).divide(3);//é“¾å¼è°ƒç”¨
NSLog(@"%ld", c.result);

//éé“¾å¼è°ƒç”¨
[c add:8];
[c subtract:4];
[c multiply:6];
[c divide:3];
NSLog(@"%ld", c.result);
```

é€šè¿‡ä¸Šé¢ğŸ‘†çš„å®ç°ä»£ç å’Œæµ‹è¯•ä»£ç å¯ä»¥çœ‹å‡ºï¼š

* ä¸€æ¬¡é“¾å¼æ–¹æ³•è°ƒç”¨æ¯”éé“¾å¼è°ƒç”¨å¤šå‡ºï¼šä¸€æ¬¡ä¸€ä¸´æ—¶ Block çš„åˆ›å»ºï¼Œä¸€æ¬¡ Block çš„æ‰§è¡Œï¼Œè€Œè¿™äº›æ˜¯ä¼šå¸¦æ¥ä¸€å®šçš„æ€§èƒ½å½±å“çš„ã€‚

æ€»ä¹‹ï¼ŒOCä¸­ä¸Šè¿°é“¾å¼ç¼–ç¨‹ç¡®å®ä¼šå¢åŠ æ–¹æ³•çš„è°ƒç”¨å±‚æ¬¡ï¼ŒåŒæ—¶ä¹Ÿèƒ½è®©ä»£ç ä¼˜é›…ã€æ˜“è¯»ã€‚å¤§å®¶é…Œæƒ…ä½¿ç”¨å³å¯ã€‚